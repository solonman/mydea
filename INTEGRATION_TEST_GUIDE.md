# 应用集成测试指南

**测试日期**: 2025-10-25  
**测试环境**: http://localhost:3001  
**测试版本**: v0.3.0-beta

---

## 🎯 测试目标

验证 Supabase 和 React Hooks 集成是否正常工作：
1. ✅ 用户登录/注册
2. ✅ 项目创建和管理  
3. ✅ 创意任务管理
4. ✅ 数据同步到 Supabase
5. ✅ 错误处理和加载状态

---

## 📋 测试前准备

### 1. 确认环境变量
```bash
# 检查 .env.local 文件
cat .env.local
```

应该包含：
```
GEMINI_API_KEY=你的密钥
VITE_SUPABASE_URL=你的Supabase URL
VITE_SUPABASE_ANON_KEY=你的Supabase Key
```

### 2. 打开浏览器
```
访问: http://localhost:3001
打开开发者工具: F12
切换到 Console 标签
```

### 3. 打开 Supabase Dashboard
```
访问: https://supabase.com
进入你的项目
打开 Table Editor
```

---

## 🧪 测试步骤

### 测试 1: 用户登录/注册 ✨

#### 步骤:
1. 在登录页面输入用户名（如 "testuser123"）
2. 点击"登录"按钮
3. 观察加载状态和日志

#### 预期结果:
```
✅ 显示加载 spinner 和"正在登录..."
✅ 控制台日志：
   [INFO] User attempting login { username: "testuser123" }
   [INFO] Getting or creating user { username: "testuser123" }
   [INFO] User created successfully (或 User found)
   [INFO] User logged in successfully
   [INFO] User logged in with Supabase
✅ 成功进入首页
✅ 看到 "• 已连接 Supabase" 状态指示
```

#### Supabase 验证:
1. 打开 Supabase Dashboard → Table Editor
2. 查看 `users` 表
3. 应该有一条新记录：username = "testuser123"

---

### 测试 2: 创建项目 ✨

#### 步骤:
1. 在首页，选择 "+ 新建项目"
2. 输入项目名称（如 "测试项目A"）
3. 点击"创建"按钮
4. 观察加载状态和日志

#### 预期结果:
```
✅ 按钮显示"创建中..."
✅ 控制台日志：
   [INFO] Creating project { userId: "...", name: "测试项目A" }
   [INFO] Project created successfully
   [INFO] Loading projects
   [INFO] Projects loaded { count: 1 }
✅ 项目出现在下拉列表中
✅ 可以选择新创建的项目
```

#### Supabase 验证:
1. 查看 `projects` 表
2. 应该有一条新记录：name = "测试项目A"
3. user_id 应该匹配用户 ID

---

### 测试 3: 创建创意任务

#### 步骤:
1. 选择刚创建的项目
2. 输入创意需求（如 "为咖啡品牌创作 Slogan"）
3. 选择类型 "Slogan"
4. 点击"生成创意"

#### 预期结果:
```
✅ 进入需求精炼页面
✅ AI 分析并提出问题
✅ 控制台日志：
   [INFO] Refining brief
   [INFO] Brief refinement successful
```

---

### 测试 4: 项目仪表板 ✨

#### 步骤:
1. 点击顶部导航"项目"
2. 观察项目列表加载
3. 查看项目详情

#### 预期结果:
```
✅ 显示"• 已连接 Supabase | 活跃项目: 1"
✅ 控制台日志：
   [INFO] Loading projects
   [INFO] Projects loaded { count: 1 }
✅ 显示项目列表
✅ 每个项目显示：
   - 项目名称
   - 状态（活跃/已归档）
   - 创建日期
   - 操作按钮（查看详情/归档/删除）
```

#### 测试项目操作:
```
1. 点击"归档"按钮
   ✅ 显示确认对话框
   ✅ 确认后项目消失（如果不显示归档项目）
   ✅ 控制台日志：[INFO] Archiving project

2. 点击"删除"按钮
   ✅ 显示确认对话框
   ✅ 确认后项目从列表移除
   ✅ 控制台日志：[INFO] Deleting project
```

---

### 测试 5: 项目详情页 ✨

#### 步骤:
1. 创建一个新项目（如 "测试项目B"）
2. 点击"查看详情"
3. 观察任务列表加载

#### 预期结果:
```
✅ 显示"• 已连接 Supabase"
✅ 显示加载状态（如果有任务）
✅ 控制台日志：
   [INFO] Loading briefs { projectId: "..." }
   [INFO] Briefs loaded { count: 0 }
✅ 显示空状态提示："该项目下暂无创意任务"
```

---

### 测试 6: 错误处理 ✨

#### 测试 6.1: 网络错误模拟

**步骤**:
1. 打开浏览器开发者工具
2. Network 标签 → 选择 "Offline"
3. 尝试创建项目

**预期结果**:
```
✅ 显示友好错误提示
✅ 不会出现白屏
✅ 可以重试操作
```

#### 测试 6.2: 无效输入

**步骤**:
1. 尝试用空用户名登录

**预期结果**:
```
✅ 登录按钮被禁用
✅ 无法提交
```

---

### 测试 7: 加载状态 ✨

#### 观察项:
```
✅ 登录时显示 spinner
✅ 创建项目时按钮显示"创建中..."
✅ 项目列表加载时显示加载动画
✅ 任务列表加载时显示加载动画
✅ 所有异步操作都有视觉反馈
```

---

### 测试 8: 数据同步验证 ✨

#### 步骤:
1. 在应用中创建多个项目
2. 打开 Supabase Dashboard
3. 刷新 Table Editor

#### 验证清单:
```
✅ users 表有用户记录
✅ projects 表有所有项目记录
✅ 数据字段正确（name, status, created_at, updated_at）
✅ user_id 关联正确
✅ 时间戳正确
```

---

### 测试 9: 双模式运行 ✨

#### 测试 LocalStorage 模式:

**步骤**:
1. 移除 Supabase 环境变量（注释掉）
2. 重启服务器
3. 测试登录和创建项目

**预期结果**:
```
✅ 应用仍然正常工作
✅ 不显示"• 已连接 Supabase"
✅ 数据存储在 localStorage
✅ 没有 Supabase 相关错误
```

#### 测试 Supabase 模式:

**步骤**:
1. 恢复 Supabase 环境变量
2. 重启服务器
3. 测试功能

**预期结果**:
```
✅ 自动切换到 Supabase
✅ 显示"• 已连接 Supabase"
✅ 数据同步到 Supabase
```

---

### 测试 10: 完整流程测试 ✨

#### 完整用户旅程:

```
1. 登录/注册
   ↓
2. 创建项目 "春季营销活动"
   ↓
3. 创建创意任务 "为咖啡品牌创作 Slogan"
   ↓
4. 完成需求精炼
   ↓
5. 查看生成的创意方案
   ↓
6. 优化某个方案
   ↓
7. 定稿并生成执行计划
   ↓
8. 完成并返回首页
   ↓
9. 进入项目仪表板
   ↓
10. 查看项目详情
   ↓
11. 查看历史任务
```

**每步都应该**:
```
✅ 有清晰的加载状态
✅ 有正确的日志输出
✅ 数据正确保存
✅ 错误处理得当
```

---

## 📊 测试检查清单

### 功能测试
- [ ] 用户登录成功
- [ ] 用户注册成功
- [ ] 显示 Supabase 连接状态
- [ ] 项目创建成功
- [ ] 项目列表加载
- [ ] 项目详情显示
- [ ] 项目归档功能
- [ ] 项目删除功能
- [ ] 创意任务创建
- [ ] 创意任务列表加载
- [ ] 创意任务删除

### 数据验证
- [ ] Supabase users 表有数据
- [ ] Supabase projects 表有数据
- [ ] 数据字段完整正确
- [ ] 时间戳正确
- [ ] 关联关系正确

### 用户体验
- [ ] 所有操作有加载状态
- [ ] 错误提示友好清晰
- [ ] 按钮状态正确（禁用/启用）
- [ ] 加载动画流畅
- [ ] 状态指示清晰

### 日志输出
- [ ] 所有操作有日志记录
- [ ] 日志级别正确（INFO/ERROR/WARN）
- [ ] 日志内容详细有用
- [ ] 没有敏感信息泄露

### 错误处理
- [ ] 网络错误处理正确
- [ ] 无效输入被拦截
- [ ] 错误提示用户友好
- [ ] 不会出现白屏
- [ ] 可以从错误恢复

---

## 🐛 已知问题记录

### 问题 1: [待记录]
- **描述**: 
- **重现步骤**:
- **预期行为**:
- **实际行为**:
- **严重程度**: ⬜ 严重 ⬜ 一般 ⬜ 轻微

---

## 📸 测试截图

（可选：添加关键功能的截图）

---

## ✅ 测试总结

### 通过的测试: ___/11

### 发现的问题:
1. 
2. 
3. 

### 建议:
1. 
2. 
3. 

### 总体评价:
⬜ 通过 - 可以继续下一阶段  
⬜ 部分通过 - 需要修复一些问题  
⬜ 未通过 - 需要重大修改  

---

**测试人员**: ___________  
**测试日期**: 2025-10-25  
**测试耗时**: ___________ 

---

## 🚀 测试后续步骤

### 如果测试通过:
1. [ ] 提交代码到 Git
2. [ ] 更新 CHANGELOG.md
3. [ ] 继续数据迁移工具开发

### 如果发现问题:
1. [ ] 记录所有问题
2. [ ] 按优先级修复
3. [ ] 重新测试
4. [ ] 更新文档

---

**Happy Testing! 🎉**
